<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Loan Comparison Tool</title>

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
        frame-ancestors 'self';
    ">

    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-header h1 {
            color: #fff;
            font-size: 1.8rem;
        }

        .admin-nav {
            display: flex;
            gap: 15px;
        }

        .admin-nav-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e0e0e0;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .admin-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .logout-btn {
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
        }

        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
        }

        .admin-section h2 {
            color: #fff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .data-table th {
            background: rgba(102, 126, 234, 0.2);
            color: #fff;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .data-table td {
            color: #e0e0e0;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #808080;
        }

        .data-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .clear-btn {
            padding: 10px 20px;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.4);
            border-radius: 8px;
            color: #ff6b6b;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        .json-viewer {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            color: #81c784;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .access-denied {
            text-align: center;
            padding: 100px 20px;
        }

        .access-denied h1 {
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        .access-denied p {
            color: #a0a0a0;
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            border-color: #667eea;
            color: #fff;
        }

        .tab-btn.active {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-container" id="adminContent" style="display: none;">
        <div class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="admin-nav">
                <a href="index.html" class="admin-nav-btn">Back to Tool</a>
                <button class="admin-nav-btn logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="admin-stats">
            <div class="stat-card">
                <h3 id="statLoanOfficers">0</h3>
                <p>Loan Officer Profiles</p>
            </div>
            <div class="stat-card">
                <h3 id="statRealtors">0</h3>
                <p>Realtor Profiles</p>
            </div>
            <div class="stat-card">
                <h3 id="statTitleAgents">0</h3>
                <p>Title Agent Profiles</p>
            </div>
            <div class="stat-card">
                <h3 id="statTitleCompanies">0</h3>
                <p>Saved Title Fee Schedules</p>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="overview">Overview</button>
            <button class="tab-btn" data-tab="loanOfficer">Loan Officer</button>
            <button class="tab-btn" data-tab="realtor">Real Estate Agent</button>
            <button class="tab-btn" data-tab="titleAgent">Title Company</button>
            <button class="tab-btn" data-tab="titleFees">Saved Title Fees</button>
            <button class="tab-btn" data-tab="rawData">Raw Data</button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="tab-overview">
            <div class="admin-section">
                <h2>All Stored Data Overview</h2>
                <div class="data-actions">
                    <button class="export-btn" id="exportAllBtn">Export All Data (JSON)</button>
                    <button class="clear-btn" id="clearAllBtn">Clear All Data</button>
                </div>
                <p style="color: #a0a0a0; margin-top: 15px;">
                    This dashboard shows all data stored in localStorage for this loan comparison tool.
                    Data is stored locally in the browser and is not transmitted to any server.
                </p>
            </div>
        </div>

        <!-- Loan Officer Tab -->
        <div class="tab-content" id="tab-loanOfficer">
            <div class="admin-section">
                <h2>Loan Officer Information</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="loanOfficerData">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Realtor Tab -->
        <div class="tab-content" id="tab-realtor">
            <div class="admin-section">
                <h2>Real Estate Agent Information</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="realtorData">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Title Agent Tab -->
        <div class="tab-content" id="tab-titleAgent">
            <div class="admin-section">
                <h2>Title Company/Agent Information</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="titleAgentData">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Title Fees Tab -->
        <div class="tab-content" id="tab-titleFees">
            <div class="admin-section">
                <h2>Saved Title Company Fee Schedules</h2>
                <div id="titleFeesData">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Raw Data Tab -->
        <div class="tab-content" id="tab-rawData">
            <div class="admin-section">
                <h2>Raw JSON Data</h2>
                <div class="data-actions">
                    <button class="export-btn" id="copyRawBtn">Copy to Clipboard</button>
                </div>
                <div class="json-viewer" id="rawJsonData">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Access Denied Message -->
    <div class="admin-container access-denied" id="accessDenied">
        <h1>Access Denied</h1>
        <p>You must be logged in as an administrator to view this page.</p>
        <a href="index.html" class="admin-nav-btn">Return to Loan Comparison Tool</a>
    </div>

    <script>
        // Admin password (hashed for basic security)
        const ADMIN_HASH = '5e884898da28047d9164137c2d1a5f3d';  // MD5 of 'LoanAdmin2024!'

        // Simple MD5 hash function
        function md5(string) {
            function rotateLeft(value, shift) {
                return (value << shift) | (value >>> (32 - shift));
            }
            function addUnsigned(x, y) {
                const x8 = (x & 0x80000000);
                const y8 = (y & 0x80000000);
                const x4 = (x & 0x40000000);
                const y4 = (y & 0x40000000);
                const result = (x & 0x3FFFFFFF) + (y & 0x3FFFFFFF);
                if (x4 & y4) return (result ^ 0x80000000 ^ x8 ^ y8);
                if (x4 | y4) {
                    if (result & 0x40000000) return (result ^ 0xC0000000 ^ x8 ^ y8);
                    else return (result ^ 0x40000000 ^ x8 ^ y8);
                } else return (result ^ x8 ^ y8);
            }
            function f(x, y, z) { return (x & y) | ((~x) & z); }
            function g(x, y, z) { return (x & z) | (y & (~z)); }
            function h(x, y, z) { return (x ^ y ^ z); }
            function i(x, y, z) { return (y ^ (x | (~z))); }
            function ff(a, b, c, d, x, s, ac) {
                a = addUnsigned(a, addUnsigned(addUnsigned(f(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            }
            function gg(a, b, c, d, x, s, ac) {
                a = addUnsigned(a, addUnsigned(addUnsigned(g(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            }
            function hh(a, b, c, d, x, s, ac) {
                a = addUnsigned(a, addUnsigned(addUnsigned(h(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            }
            function ii(a, b, c, d, x, s, ac) {
                a = addUnsigned(a, addUnsigned(addUnsigned(i(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            }
            function convertToWordArray(string) {
                let messageLength = string.length;
                let numberOfWords = (((messageLength + 8) - ((messageLength + 8) % 64)) / 64 + 1) * 16;
                let wordArray = Array(numberOfWords - 1);
                let wordCount, bytePosition = 0, byteCount = 0;
                while (byteCount < messageLength) {
                    wordCount = (byteCount - (byteCount % 4)) / 4;
                    bytePosition = (byteCount % 4) * 8;
                    wordArray[wordCount] = (wordArray[wordCount] | (string.charCodeAt(byteCount) << bytePosition));
                    byteCount++;
                }
                wordCount = (byteCount - (byteCount % 4)) / 4;
                bytePosition = (byteCount % 4) * 8;
                wordArray[wordCount] = wordArray[wordCount] | (0x80 << bytePosition);
                wordArray[numberOfWords - 2] = messageLength << 3;
                wordArray[numberOfWords - 1] = messageLength >>> 29;
                return wordArray;
            }
            function wordToHex(value) {
                let hex = '', temp, byte;
                for (byte = 0; byte <= 3; byte++) {
                    temp = (value >>> (byte * 8)) & 255;
                    hex = hex + ('0' + temp.toString(16)).slice(-2);
                }
                return hex;
            }
            let x = convertToWordArray(string);
            let a = 0x67452301, b = 0xEFCDAB89, c = 0x98BADCFE, d = 0x10325476;
            const S11 = 7, S12 = 12, S13 = 17, S14 = 22;
            const S21 = 5, S22 = 9, S23 = 14, S24 = 20;
            const S31 = 4, S32 = 11, S33 = 16, S34 = 23;
            const S41 = 6, S42 = 10, S43 = 15, S44 = 21;
            for (let k = 0; k < x.length; k += 16) {
                let AA = a, BB = b, CC = c, DD = d;
                a = ff(a, b, c, d, x[k], S11, 0xD76AA478);
                d = ff(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
                c = ff(c, d, a, b, x[k + 2], S13, 0x242070DB);
                b = ff(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
                a = ff(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
                d = ff(d, a, b, c, x[k + 5], S12, 0x4787C62A);
                c = ff(c, d, a, b, x[k + 6], S13, 0xA8304613);
                b = ff(b, c, d, a, x[k + 7], S14, 0xFD469501);
                a = ff(a, b, c, d, x[k + 8], S11, 0x698098D8);
                d = ff(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
                c = ff(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
                b = ff(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
                a = ff(a, b, c, d, x[k + 12], S11, 0x6B901122);
                d = ff(d, a, b, c, x[k + 13], S12, 0xFD987193);
                c = ff(c, d, a, b, x[k + 14], S13, 0xA679438E);
                b = ff(b, c, d, a, x[k + 15], S14, 0x49B40821);
                a = gg(a, b, c, d, x[k + 1], S21, 0xF61E2562);
                d = gg(d, a, b, c, x[k + 6], S22, 0xC040B340);
                c = gg(c, d, a, b, x[k + 11], S23, 0x265E5A51);
                b = gg(b, c, d, a, x[k], S24, 0xE9B6C7AA);
                a = gg(a, b, c, d, x[k + 5], S21, 0xD62F105D);
                d = gg(d, a, b, c, x[k + 10], S22, 0x2441453);
                c = gg(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
                b = gg(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
                a = gg(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
                d = gg(d, a, b, c, x[k + 14], S22, 0xC33707D6);
                c = gg(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
                b = gg(b, c, d, a, x[k + 8], S24, 0x455A14ED);
                a = gg(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
                d = gg(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
                c = gg(c, d, a, b, x[k + 7], S23, 0x676F02D9);
                b = gg(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
                a = hh(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
                d = hh(d, a, b, c, x[k + 8], S32, 0x8771F681);
                c = hh(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
                b = hh(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
                a = hh(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
                d = hh(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
                c = hh(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
                b = hh(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
                a = hh(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
                d = hh(d, a, b, c, x[k], S32, 0xEAA127FA);
                c = hh(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
                b = hh(b, c, d, a, x[k + 6], S34, 0x4881D05);
                a = hh(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
                d = hh(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
                c = hh(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
                b = hh(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
                a = ii(a, b, c, d, x[k], S41, 0xF4292244);
                d = ii(d, a, b, c, x[k + 7], S42, 0x432AFF97);
                c = ii(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
                b = ii(b, c, d, a, x[k + 5], S44, 0xFC93A039);
                a = ii(a, b, c, d, x[k + 12], S41, 0x655B59C3);
                d = ii(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
                c = ii(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
                b = ii(b, c, d, a, x[k + 1], S44, 0x85845DD1);
                a = ii(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
                d = ii(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
                c = ii(c, d, a, b, x[k + 6], S43, 0xA3014314);
                b = ii(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
                a = ii(a, b, c, d, x[k + 4], S41, 0xF7537E82);
                d = ii(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
                c = ii(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
                b = ii(b, c, d, a, x[k + 9], S44, 0xEB86D391);
                a = addUnsigned(a, AA);
                b = addUnsigned(b, BB);
                c = addUnsigned(c, CC);
                d = addUnsigned(d, DD);
            }
            return (wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d)).toLowerCase();
        }

        // Security utility for escaping HTML
        function escapeHtml(str) {
            if (str === null || str === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(str);
            return div.innerHTML;
        }

        // Check if admin is authenticated with token validation
        function checkAuth() {
            const token = sessionStorage.getItem('adminToken');
            const tokenTime = parseInt(sessionStorage.getItem('adminTokenTime') || '0');
            const maxAge = 30 * 60 * 1000; // 30 minutes session timeout

            // Validate token exists and is not expired
            const isValid = token && token.length === 32 && (Date.now() - tokenTime) < maxAge;

            if (isValid) {
                // Refresh token time on activity
                sessionStorage.setItem('adminTokenTime', Date.now().toString());
                document.getElementById('adminContent').style.display = 'block';
                document.getElementById('accessDenied').style.display = 'none';
                loadAdminData();
            } else {
                // Clear any stale tokens
                sessionStorage.removeItem('adminToken');
                sessionStorage.removeItem('adminTokenTime');
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('accessDenied').style.display = 'block';
            }
        }

        // Load all admin data
        function loadAdminData() {
            let settings;
            try {
                settings = JSON.parse(localStorage.getItem('loanComparisonSettings') || '{}');
            } catch (e) {
                settings = {};
            }

            // Update stats (using textContent is safe)
            document.getElementById('statLoanOfficers').textContent = settings.loanOfficer?.name ? '1' : '0';
            document.getElementById('statRealtors').textContent = settings.realtor?.name ? '1' : '0';
            document.getElementById('statTitleAgents').textContent = settings.titleAgent?.company ? '1' : '0';
            document.getElementById('statTitleCompanies').textContent = settings.titleCompanies?.length || '0';

            // Loan Officer Data - escape all values
            const loData = settings.loanOfficer || {};
            document.getElementById('loanOfficerData').innerHTML = `
                <tr><td>Name</td><td>${escapeHtml(loData.name) || '-'}</td></tr>
                <tr><td>Company</td><td>${escapeHtml(loData.company) || '-'}</td></tr>
                <tr><td>Phone</td><td>${escapeHtml(loData.phone) || '-'}</td></tr>
                <tr><td>Email</td><td>${escapeHtml(loData.email) || '-'}</td></tr>
                <tr><td>NMLS #</td><td>${escapeHtml(loData.nmls) || '-'}</td></tr>
            `;

            // Realtor Data - escape all values
            const realtorData = settings.realtor || {};
            document.getElementById('realtorData').innerHTML = `
                <tr><td>Enabled on Documents</td><td>${realtorData.enabled ? 'Yes' : 'No'}</td></tr>
                <tr><td>Name</td><td>${escapeHtml(realtorData.name) || '-'}</td></tr>
                <tr><td>Company</td><td>${escapeHtml(realtorData.company) || '-'}</td></tr>
                <tr><td>Phone</td><td>${escapeHtml(realtorData.phone) || '-'}</td></tr>
                <tr><td>Email</td><td>${escapeHtml(realtorData.email) || '-'}</td></tr>
                <tr><td>License #</td><td>${escapeHtml(realtorData.license) || '-'}</td></tr>
            `;

            // Title Agent Data - escape all values
            const titleAgentData = settings.titleAgent || {};
            document.getElementById('titleAgentData').innerHTML = `
                <tr><td>Enabled on Documents</td><td>${titleAgentData.enabled ? 'Yes' : 'No'}</td></tr>
                <tr><td>Company</td><td>${escapeHtml(titleAgentData.company) || '-'}</td></tr>
                <tr><td>Contact Name</td><td>${escapeHtml(titleAgentData.name) || '-'}</td></tr>
                <tr><td>Phone</td><td>${escapeHtml(titleAgentData.phone) || '-'}</td></tr>
                <tr><td>Email</td><td>${escapeHtml(titleAgentData.email) || '-'}</td></tr>
                <tr><td>Address</td><td>${escapeHtml(titleAgentData.address) || '-'}</td></tr>
            `;

            // Title Fees Data - escape all values
            const titleFees = settings.titleCompanies || [];
            if (titleFees.length === 0) {
                document.getElementById('titleFeesData').innerHTML = '<p class="no-data">No saved title fee schedules</p>';
            } else {
                let feesHtml = '';
                titleFees.forEach((tc, index) => {
                    // Sanitize numeric values
                    const sanitizeNum = (val) => parseFloat(val) || 0;
                    feesHtml += `
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">${escapeHtml(tc.name)}</h4>
                            <table class="data-table">
                                <tr><td>Title Insurance (Lender)</td><td>$${sanitizeNum(tc.titleInsurance)}</td></tr>
                                <tr><td>Title Insurance (Owner)</td><td>$${sanitizeNum(tc.ownersTitleInsurance)}</td></tr>
                                <tr><td>Title Search</td><td>$${sanitizeNum(tc.titleSearch)}</td></tr>
                                <tr><td>Settlement Fee</td><td>$${sanitizeNum(tc.settlementFee)}</td></tr>
                                <tr><td>Escrow Fees</td><td>$${sanitizeNum(tc.escrowFees)}</td></tr>
                                <tr><td>Recording Fees</td><td>$${sanitizeNum(tc.recordingFees)}</td></tr>
                                <tr><td>Notary Fees</td><td>$${sanitizeNum(tc.notaryFees)}</td></tr>
                                <tr><td>Courier Fees</td><td>$${sanitizeNum(tc.courierFees)}</td></tr>
                                <tr><td>Attorney Fees</td><td>$${sanitizeNum(tc.attorneyFees)}</td></tr>
                            </table>
                        </div>
                    `;
                });
                document.getElementById('titleFeesData').innerHTML = feesHtml;
            }

            // Raw JSON Data (textContent is safe)
            document.getElementById('rawJsonData').textContent = JSON.stringify(settings, null, 2);
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
            });
        });

        // Logout - clear all session data
        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('adminToken');
            sessionStorage.removeItem('adminTokenTime');
            window.location.href = 'index.html';
        });

        // Export all data
        document.getElementById('exportAllBtn').addEventListener('click', () => {
            const settings = localStorage.getItem('loanComparisonSettings') || '{}';
            const blob = new Blob([settings], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'loan_comparison_data_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Copy raw data
        document.getElementById('copyRawBtn').addEventListener('click', () => {
            const text = document.getElementById('rawJsonData').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Data copied to clipboard!');
            });
        });

        // Clear all data
        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear ALL stored data? This cannot be undone.')) {
                if (confirm('This will delete all loan officer info, realtor info, title company info, and saved fee schedules. Continue?')) {
                    localStorage.removeItem('loanComparisonSettings');
                    loadAdminData();
                    alert('All data has been cleared.');
                }
            }
        });

        // Initialize
        checkAuth();
    </script>
</body>
</html>
