<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>LoanDr. - Loan Comparison Tool</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LoanDr.">
    <meta name="application-name" content="LoanDr.">
    <meta name="msapplication-TileColor" content="#1e3a5f">
    <meta name="msapplication-config" content="browserconfig.xml">

    <!-- App Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">

    <!-- Security Headers via Meta Tags -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: blob:;
        font-src 'self';
        connect-src 'self';
        frame-ancestors 'self';
        form-action 'self';
        base-uri 'self';
    ">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="app.css">
    <meta name="theme-color" content="#1e3a5f">

    <!-- Core modules - load early for theme flash prevention -->
    <script src="theme.js"></script>
    <script src="security.js"></script>
    <script src="pwa.js" defer></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Page Switcher Tab -->
    <div class="page-switcher">
        <a href="index.html" class="page-tab active" data-page="forward">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span>Forward Mortgages</span>
        </a>
        <a href="hecm.html" class="page-tab" data-page="hecm">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="8" r="5"/>
                <path d="M20 21a8 8 0 0 0-16 0"/>
                <path d="M12 13v8"/>
                <path d="M9 18h6"/>
            </svg>
            <span>Reverse Mortgages (HECM)</span>
        </a>
        <a href="tools.html" class="page-tab" data-page="tools">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
            <span>Mortgage Tools</span>
        </a>
    </div>

    <div class="mountain-layer-3"></div>
    <div class="mountain-layer-2"></div>
    <div class="mountain-front"></div>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-text">
                    <div class="logo">
                        <img src="logo.svg" alt="LoanDr." class="logo-img-header">
                    </div>
                </div>
                <div class="header-actions">
                    <div class="user-info" id="userInfo">
                        <span class="user-name" id="userName"></span>
                        <span class="user-company" id="userCompany"></span>
                    </div>
                    <button class="settings-btn" id="settingsBtn" title="Settings">
                        <svg class="settings-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                        <span class="settings-text">Settings</span>
                    </button>
                    <button class="logout-btn" id="logoutBtn" title="Sign Out">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        <span class="logout-text">Sign Out</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Settings Panel (Slide-out) -->
        <div class="settings-panel hidden" id="settingsPanel">
            <div class="settings-header">
                <h2>Settings</h2>
                <button class="close-settings" id="closeSettings">&times;</button>
            </div>

            <div class="settings-body">
                <!-- Appearance Settings -->
                <div class="settings-section">
                    <h3>Appearance</h3>
                    <p class="settings-note">Customize the look and feel of the application</p>

                    <div class="branding-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-text">Dark Mode</span>
                    </div>
                </div>

                <!-- Account Info -->
                <div class="settings-section">
                    <h3>My Account</h3>
                    <p class="settings-note">Your information for documents and contact details</p>

                    <div class="settings-form">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" id="loName" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="loCompany" placeholder="ABC Mortgage">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="loPhone" placeholder="(555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loEmail" placeholder="john@abcmortgage.com">
                        </div>
                        <div class="form-group">
                            <label>NMLS #</label>
                            <input type="text" id="loNMLS" placeholder="123456">
                        </div>
                    </div>

                    <button class="save-settings-btn" id="saveLOSettings">Save Loan Officer Info</button>
                </div>

                <!-- Lender Information -->
                <div class="settings-section">
                    <h3>Lender Information</h3>
                    <p class="settings-note">Enter your lending institution's details for documents and branding</p>

                    <div class="settings-form">
                        <div class="form-group">
                            <label>Lender Name</label>
                            <input type="text" id="lenderName" placeholder="First National Bank">
                        </div>
                        <div class="form-group">
                            <label>Lender NMLS #</label>
                            <input type="text" id="lenderNMLS" placeholder="123456">
                        </div>
                        <div class="form-group">
                            <label>Main Phone</label>
                            <input type="tel" id="lenderPhone" placeholder="(800) 555-1234">
                        </div>
                        <div class="form-group">
                            <label>Website</label>
                            <input type="url" id="lenderWebsite" placeholder="www.firstnationalbank.com">
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="lenderAddress" placeholder="123 Main Street, Suite 100">
                        </div>
                        <div class="form-group">
                            <label>City, State ZIP</label>
                            <input type="text" id="lenderCityStateZip" placeholder="New York, NY 10001">
                        </div>
                        <div class="form-group full-width">
                            <label>Equal Housing Lender Statement</label>
                            <textarea id="lenderDisclaimer" rows="2" placeholder="Equal Housing Lender. NMLS# 123456"></textarea>
                        </div>
                    </div>

                    <button class="save-settings-btn" id="saveLenderSettings">Save Lender Info</button>
                </div>

                <!-- Dual Branding - Real Estate Agent -->
                <div class="settings-section">
                    <h3>Real Estate Agent (Dual Branding)</h3>
                    <p class="settings-note">Add a real estate agent's info to appear on generated documents</p>

                    <div class="branding-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableRealtorBranding">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-text">Include on documents</span>
                    </div>

                    <div class="settings-form" id="realtorForm">
                        <div class="form-group">
                            <label>Agent Name</label>
                            <input type="text" id="realtorName" placeholder="Jane Doe">
                        </div>
                        <div class="form-group">
                            <label>Brokerage/Company</label>
                            <input type="text" id="realtorCompany" placeholder="ABC Realty">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="realtorPhone" placeholder="(555) 987-6543">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="realtorEmail" placeholder="jane@abcrealty.com">
                        </div>
                        <div class="form-group">
                            <label>License #</label>
                            <input type="text" id="realtorLicense" placeholder="RE-123456">
                        </div>
                    </div>

                    <button class="save-settings-btn" id="saveRealtorSettings">Save Real Estate Agent Info</button>
                </div>

                <!-- Dual Branding - Title Company/Agent -->
                <div class="settings-section">
                    <h3>Title Company/Agent (Dual Branding)</h3>
                    <p class="settings-note">Add a title company or settlement agent's info to appear on generated documents</p>

                    <div class="branding-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTitleBranding">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-text">Include on documents</span>
                    </div>

                    <div class="settings-form" id="titleAgentForm">
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="titleAgentCompany" placeholder="First American Title">
                        </div>
                        <div class="form-group">
                            <label>Contact Name</label>
                            <input type="text" id="titleAgentName" placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="titleAgentPhone" placeholder="(555) 456-7890">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="titleAgentEmail" placeholder="john@firstamerican.com">
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="titleAgentAddress" placeholder="123 Main St, City, ST 12345">
                        </div>
                    </div>

                    <button class="save-settings-btn" id="saveTitleAgentSettings">Save Title Company Info</button>
                </div>

                <!-- Title Company Fees -->
                <div class="settings-section">
                    <h3>Saved Title Company Fees</h3>
                    <p class="settings-note">Save fee schedules from title companies for quick reuse</p>

                    <div class="title-company-list" id="titleCompanyList">
                        <!-- Populated by JS -->
                    </div>

                    <div class="add-title-company">
                        <h4>Save Current Fees as Title Company</h4>
                        <div class="form-group">
                            <label>Title Company Name</label>
                            <input type="text" id="newTitleCompanyName" placeholder="e.g., First American Title">
                        </div>
                        <button class="save-settings-btn" id="saveTitleCompany">Save Current Title Fees</button>
                    </div>
                </div>

                <!-- Help & Support Section -->
                <div class="settings-section help-section">
                    <h3>Help & Support</h3>
                    <p class="settings-note">Get help using LoanDr. or contact us with questions</p>

                    <div class="help-links">
                        <a href="help.html" class="help-center-link">
                            <svg class="help-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                            <div class="help-link-content">
                                <strong>Help Center</strong>
                                <span>Guides, FAQs, glossary, and tutorials</span>
                            </div>
                            <svg class="arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                        </a>
                        <a href="help.html#contact" class="help-center-link">
                            <svg class="help-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                            <div class="help-link-content">
                                <strong>Contact Support</strong>
                                <span>Send us a message</span>
                            </div>
                            <svg class="arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                        </a>
                        <a href="help.html#shortcuts" class="help-center-link">
                            <svg class="help-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"/><line x1="6" y1="8" x2="6" y2="8"/><line x1="10" y1="8" x2="10" y2="8"/><line x1="14" y1="8" x2="14" y2="8"/><line x1="18" y1="8" x2="18" y2="8"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="6" y1="16" x2="10" y2="16"/></svg>
                            <div class="help-link-content">
                                <strong>Keyboard Shortcuts</strong>
                                <span>Work faster with shortcuts</span>
                            </div>
                            <svg class="arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                        </a>
                    </div>

                    <div class="help-version">
                        <small>LoanDr. v1.0 | Made for Loan Officers</small>
                    </div>
                </div>

                <!-- Admin Section -->
                <div class="settings-section admin-section">
                    <h3>Administrator</h3>
                    <p class="settings-note">Access admin dashboard to view all collected data</p>

                    <div class="admin-login-form" id="adminLoginForm">
                        <div class="form-group">
                            <label>Admin Password</label>
                            <input type="password" id="adminPassword" placeholder="Enter admin password">
                        </div>
                        <button class="admin-login-btn" id="adminLoginBtn">Sign In as Admin</button>
                        <p class="admin-error hidden" id="adminError">Incorrect password</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="settings-overlay hidden" id="settingsOverlay"></div>

        <div class="comparison-container">
            <!-- Loan comparison tabs -->
            <div class="loan-tabs-container">
                <div class="loan-tabs" id="loanTabs">
                    <button class="loan-tab active" data-index="0">Scenario 1</button>
                </div>
                <button class="add-loan-btn" id="addLoanBtn" title="Add another scenario to compare (up to 6)">
                    <span class="plus-icon">+</span>
                </button>
                <div class="scenario-actions">
                    <button class="scenario-action-btn my-scenarios-btn" id="myScenariosBtn" title="View and manage saved scenarios">
                        My Scenarios
                    </button>
                    <button class="scenario-action-btn save-btn" id="saveScenarioBtn" title="Save current scenarios">
                        Save
                    </button>
                    <button class="scenario-action-btn export-btn" id="exportDataBtn" title="Download to file">
                        Export
                    </button>
                    <label class="scenario-action-btn import-btn" title="Import from file">
                        Import
                        <input type="file" id="importDataInput" accept=".json,.loancomp" style="display: none;">
                    </label>
                </div>
            </div>

            <!-- Saved Scenarios Modal -->
            <div class="saved-scenarios-modal hidden" id="savedScenariosModal">
                <div class="saved-scenarios-content">
                    <div class="saved-scenarios-header">
                        <h3>Saved Scenarios</h3>
                        <button class="close-saved-btn" id="closeSavedModal">&times;</button>
                    </div>
                    <div class="saved-scenarios-body">
                        <div class="saved-list" id="savedScenariosList">
                            <!-- Populated by JS -->
                        </div>
                        <div class="save-new-section">
                            <h4>Save Current Session</h4>
                            <div class="save-input-row">
                                <input type="text" id="saveScenarioName" placeholder="Enter a name for this comparison...">
                                <button class="btn-save-new" id="saveNewScenarioBtn">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="saved-scenarios-overlay hidden" id="savedScenariosOverlay"></div>

            <!-- All loan panels container -->
            <div class="loan-panels" id="loanPanels">
                <!-- First loan panel (template) -->
                <div class="loan-panel active" data-index="0">
                    <!-- Purchase/Refinance Toggle -->
                    <div class="top-toggles">
                        <div class="transaction-toggle">
                            <button class="toggle-btn active" data-type="purchase">Purchase</button>
                            <button class="toggle-btn" data-type="refinance">Refinance</button>
                        </div>

                        <!-- Borrower Toggle -->
                        <div class="borrower-toggle">
                            <span class="toggle-label">Borrowers:</span>
                            <button class="borrower-btn active" data-borrowers="1">1</button>
                            <button class="borrower-btn" data-borrowers="2">2</button>
                        </div>
                    </div>

                    <!-- Loan Type Tabs -->
                    <div class="loan-type-tabs">
                        <button class="type-tab active" data-loan="conventional">Conventional</button>
                        <button class="type-tab" data-loan="fha">FHA</button>
                        <button class="type-tab" data-loan="va">VA</button>
                        <button class="type-tab" data-loan="usda">USDA</button>
                        <button class="type-tab" data-loan="arm">ARM</button>
                    </div>

                    <!-- Loan Program Type -->
                    <div class="loan-program-section">
                        <label class="program-label">Loan Program:</label>
                        <div class="loan-program-tabs">
                            <button class="program-tab active" data-program="standard">Standard</button>
                            <button class="program-tab" data-program="homeready">HomeReady</button>
                            <button class="program-tab" data-program="homepossible">Home Possible</button>
                            <button class="program-tab" data-program="firsttime">First Time Homebuyer</button>
                            <button class="program-tab" data-program="affordable">Affordable/Community</button>
                        </div>
                        <div class="program-info hidden">
                            <p class="program-description"></p>
                        </div>
                    </div>

                    <!-- Loan Form -->
                    <form class="loan-form">
                        <!-- Scenario Name -->
                        <div class="form-section scenario-name-section">
                            <div class="form-group">
                                <label>Scenario Name (Optional)</label>
                                <input type="text" name="scenarioName" placeholder="e.g., Low Down Payment Option">
                            </div>

                            <!-- Comparison Type Toggle -->
                            <div class="comparison-type-toggle" id="comparisonTypeToggle">
                                <label class="toggle-label">Comparison Type:</label>
                                <div class="comparison-type-buttons">
                                    <button type="button" class="comparison-type-btn active" data-type="same" title="Same property, different loan options">
                                        <svg class="type-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                        <span class="type-text">Same Property</span>
                                    </button>
                                    <button type="button" class="comparison-type-btn" data-type="different" title="Different properties">
                                        <svg class="type-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                        <svg class="type-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                        <span class="type-text">Different Properties</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Property Address (shown when comparing different properties) -->
                            <div class="property-address-group hidden" id="propertyAddressGroup">
                                <label>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                        <circle cx="12" cy="10" r="3"/>
                                    </svg>
                                    Property Address
                                </label>
                                <input type="text" name="propertyAddress" placeholder="e.g., 123 Main St, City, State 12345">
                            </div>
                        </div>

                        <!-- Common Fields -->
                        <div class="form-section">
                            <h3>Loan Details</h3>

                            <div class="form-group">
                                <label>Purchase Price / Home Value</label>
                                <div class="input-wrapper">
                                    <span class="currency">$</span>
                                    <input type="number" name="homePrice" placeholder="300,000" value="300000">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="tooltip-trigger">
                                    Loan Amount
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">The total amount you're borrowing, typically Home Price minus Down Payment.</span>
                                </label>
                                <div class="input-wrapper">
                                    <span class="currency">$</span>
                                    <input type="number" name="loanAmount" placeholder="270,000" value="270000">
                                </div>
                            </div>

                            <div class="form-group down-payment-group">
                                <label class="tooltip-trigger">
                                    Down Payment
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">The upfront cash you pay toward the home. A larger down payment means a smaller loan and lower monthly payments. 20%+ avoids PMI on conventional loans.</span>
                                </label>
                                <div class="input-row">
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="downPayment" placeholder="30,000" value="30000">
                                    </div>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="downPaymentPercent" placeholder="10" value="10" step="0.1">
                                        <span class="percent">%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="tooltip-trigger">
                                    Interest Rate
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">The annual percentage charged by the lender for borrowing money. Even small rate differences can significantly impact your total cost over the loan term.</span>
                                </label>
                                <div class="input-wrapper percent-wrapper">
                                    <input type="number" name="interestRate" placeholder="6.5" value="6.5" step="0.125">
                                    <span class="percent">%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="tooltip-trigger">
                                    Loan Term
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">The length of your mortgage. Shorter terms have higher monthly payments but less total interest paid. 30-year is most common.</span>
                                </label>
                                <select name="loanTerm">
                                    <option value="30">30 Years</option>
                                    <option value="20">20 Years</option>
                                    <option value="15">15 Years</option>
                                    <option value="10">10 Years</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Credit Score Range</label>
                                <select name="creditScore">
                                    <option value="800">800-850 (Exceptional)</option>
                                    <option value="780">780-799 (Exceptional)</option>
                                    <option value="760">760-779 (Excellent)</option>
                                    <option value="740">740-759 (Very Good)</option>
                                    <option value="720">720-739 (Good)</option>
                                    <option value="700" selected>700-719 (Good)</option>
                                    <option value="680">680-699 (Fair)</option>
                                    <option value="660">660-679 (Fair)</option>
                                    <option value="640">640-659 (Poor)</option>
                                    <option value="620">620-639 (Poor)</option>
                                    <option value="580">580-619 (Very Poor)</option>
                                </select>
                            </div>

                            <!-- Second Borrower Credit Score (shown when 2 borrowers) -->
                            <div class="form-group second-borrower-credit hidden">
                                <label>Second Borrower Credit Score</label>
                                <select name="creditScore2">
                                    <option value="800">800-850 (Exceptional)</option>
                                    <option value="780">780-799 (Exceptional)</option>
                                    <option value="760">760-779 (Excellent)</option>
                                    <option value="740">740-759 (Very Good)</option>
                                    <option value="720">720-739 (Good)</option>
                                    <option value="700" selected>700-719 (Good)</option>
                                    <option value="680">680-699 (Fair)</option>
                                    <option value="660">660-679 (Fair)</option>
                                    <option value="640">640-659 (Poor)</option>
                                    <option value="620">620-639 (Poor)</option>
                                    <option value="580">580-619 (Very Poor)</option>
                                </select>
                                <small class="helper-text">Lenders typically use the lower of the two scores</small>
                            </div>
                        </div>

                        <!-- Rate Buydown & Credits Section -->
                        <div class="form-section buydown-section">
                            <h3>Rate Buydown & Credits</h3>

                            <div class="form-group">
                                <label>Are you buying down the rate?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="buyingPoints" value="no" checked>
                                        <span>No</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="buyingPoints" value="yes">
                                        <span>Yes</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group points-amount hidden">
                                <label class="tooltip-trigger">
                                    Discount Points
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">Prepaid interest to lower your rate. 1 point = 1% of loan amount. Generally worth it if you keep the loan 5+ years.</span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" name="discountPoints" placeholder="1.0" value="0" step="0.125">
                                    <span class="percent">pts</span>
                                </div>
                                <small class="helper-text">1 point = 1% of loan amount</small>
                            </div>

                            <!-- Credits Section -->
                            <h4 class="subsection-title" style="margin-top: 20px;">Credits</h4>
                            <div class="closing-costs-grid">
                                <div class="cost-item">
                                    <label>Lender Credit</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="lenderCredit" value="0">
                                    </div>
                                    <small class="helper-text">Reduces closing costs</small>
                                </div>
                                <div class="cost-item">
                                    <label>Seller Credit</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="sellerCredit" value="0">
                                    </div>
                                    <small class="helper-text">Seller concessions</small>
                                </div>
                                <div class="cost-item">
                                    <label>Other Credits</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="otherCredits" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loan-Specific Fields -->
                        <div class="form-section loan-specific-fields">
                            <!-- FHA Specific -->
                            <div class="fha-fields hidden">
                                <h3>FHA Specific</h3>
                                <div class="form-group">
                                    <label>Upfront MIP Rate</label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="upfrontMIPRate" value="1.75" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Upfront MIP Amount</label>
                                    <div class="calculated-value" data-field="upfrontMIP">$0</div>
                                </div>
                                <div class="form-group">
                                    <label>Annual MIP Rate</label>
                                    <select name="annualMIPRate">
                                        <option value="0.55">0.55% (≤15yr, ≤90% LTV)</option>
                                        <option value="0.70">0.70% (≤15yr, >90% LTV)</option>
                                        <option value="0.50">0.50% (>15yr, ≤90% LTV)</option>
                                        <option value="0.55" selected>0.55% (>15yr, >90% LTV)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- VA Specific -->
                            <div class="va-fields hidden">
                                <h3>VA Specific</h3>
                                <div class="form-group">
                                    <label>First Time VA Loan Use?</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="firstTimeVA" value="yes" checked>
                                            <span>Yes</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="firstTimeVA" value="no">
                                            <span>No</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Service Type</label>
                                    <select name="serviceType">
                                        <option value="regular">Regular Military</option>
                                        <option value="reserves">Reserves/National Guard</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Disability Exemption?</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="vaExempt" value="no" checked>
                                            <span>No</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="vaExempt" value="yes">
                                            <span>Yes (Exempt from Funding Fee)</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>VA Funding Fee Rate (Override)</label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="vaFundingFeeRate" placeholder="Auto" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                    <small class="helper-text">Leave blank for auto-calculation</small>
                                </div>
                                <div class="form-group">
                                    <label>VA Funding Fee</label>
                                    <div class="calculated-value" data-field="vaFundingFee">$0</div>
                                </div>
                            </div>

                            <!-- USDA Specific -->
                            <div class="usda-fields hidden">
                                <h3>USDA Specific</h3>
                                <div class="form-group">
                                    <label>Upfront Guarantee Fee Rate</label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="usdaUpfrontRate" value="1.0" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Upfront Guarantee Fee</label>
                                    <div class="calculated-value" data-field="usdaUpfront">$0</div>
                                </div>
                                <div class="form-group">
                                    <label>Annual Fee Rate</label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="usdaAnnualRate" value="0.35" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ARM Specific -->
                            <div class="arm-fields hidden">
                                <h3>ARM Details</h3>
                                <div class="arm-info-banner">
                                    <svg class="info-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                    <span>Adjustable Rate Mortgages have a fixed initial rate that adjusts periodically after the initial period.</span>
                                </div>

                                <div class="form-group">
                                    <label class="tooltip-trigger">
                                        ARM Type
                                        <span class="tooltip-icon" tabindex="0">?</span>
                                        <span class="tooltip-content">The first number is years at initial rate, the second is how often it adjusts after. Example: 5/1 = 5 years fixed, then adjusts yearly.</span>
                                    </label>
                                    <select name="armType">
                                        <option value="5/1">5/1 ARM (5 years fixed, adjusts yearly)</option>
                                        <option value="7/1">7/1 ARM (7 years fixed, adjusts yearly)</option>
                                        <option value="10/1">10/1 ARM (10 years fixed, adjusts yearly)</option>
                                        <option value="3/1">3/1 ARM (3 years fixed, adjusts yearly)</option>
                                        <option value="5/6">5/6 ARM (5 years fixed, adjusts every 6 months)</option>
                                        <option value="7/6">7/6 ARM (7 years fixed, adjusts every 6 months)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="tooltip-trigger">
                                        Initial Rate (Teaser Rate)
                                        <span class="tooltip-icon" tabindex="0">?</span>
                                        <span class="tooltip-content">The interest rate during the initial fixed period. Usually lower than fixed-rate mortgages.</span>
                                    </label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="armInitialRate" value="5.5" step="0.125">
                                        <span class="percent">%</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="tooltip-trigger">
                                        Index
                                        <span class="tooltip-icon" tabindex="0">?</span>
                                        <span class="tooltip-content">The benchmark rate your ARM is tied to. SOFR is most common for new ARMs.</span>
                                    </label>
                                    <select name="armIndex">
                                        <option value="sofr">SOFR (Secured Overnight Financing Rate)</option>
                                        <option value="treasury">1-Year Treasury</option>
                                        <option value="prime">Prime Rate</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="tooltip-trigger">
                                        Current Index Rate
                                        <span class="tooltip-icon" tabindex="0">?</span>
                                        <span class="tooltip-content">The current value of the index. Used to project future rate adjustments.</span>
                                    </label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="armIndexRate" value="5.0" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="tooltip-trigger">
                                        Margin
                                        <span class="tooltip-icon" tabindex="0">?</span>
                                        <span class="tooltip-content">Added to the index to determine your rate after adjustments. Typically 2-3%. Your adjusted rate = Index + Margin.</span>
                                    </label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="armMargin" value="2.75" step="0.125">
                                        <span class="percent">%</span>
                                    </div>
                                </div>

                                <h4 class="subsection-title">Rate Caps</h4>
                                <div class="arm-caps-grid">
                                    <div class="form-group">
                                        <label class="tooltip-trigger">
                                            Initial Cap
                                            <span class="tooltip-icon" tabindex="0">?</span>
                                            <span class="tooltip-content">Maximum rate increase at first adjustment after the initial period.</span>
                                        </label>
                                        <div class="input-wrapper percent-wrapper">
                                            <input type="number" name="armInitialCap" value="2" step="0.5">
                                            <span class="percent">%</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="tooltip-trigger">
                                            Periodic Cap
                                            <span class="tooltip-icon" tabindex="0">?</span>
                                            <span class="tooltip-content">Maximum rate change at each subsequent adjustment.</span>
                                        </label>
                                        <div class="input-wrapper percent-wrapper">
                                            <input type="number" name="armPeriodicCap" value="2" step="0.5">
                                            <span class="percent">%</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="tooltip-trigger">
                                            Lifetime Cap
                                            <span class="tooltip-icon" tabindex="0">?</span>
                                            <span class="tooltip-content">Maximum total rate increase over the life of the loan from the initial rate.</span>
                                        </label>
                                        <div class="input-wrapper percent-wrapper">
                                            <input type="number" name="armLifetimeCap" value="5" step="0.5">
                                            <span class="percent">%</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="arm-projection">
                                    <h4>Rate Projection</h4>
                                    <div class="projection-values">
                                        <div class="projection-item">
                                            <span class="projection-label">Initial Rate</span>
                                            <span class="projection-value" data-field="armInitialDisplay">5.500%</span>
                                        </div>
                                        <div class="projection-item">
                                            <span class="projection-label">Worst Case (Max)</span>
                                            <span class="projection-value worst-case" data-field="armWorstCase">10.500%</span>
                                        </div>
                                        <div class="projection-item">
                                            <span class="projection-label">Fully Indexed Rate</span>
                                            <span class="projection-value" data-field="armFullyIndexed">7.750%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Conventional PMI -->
                            <div class="conventional-fields">
                                <h3>Private Mortgage Insurance (PMI)</h3>
                                <div class="form-group pmi-required">
                                    <label>PMI Required?</label>
                                    <div class="calculated-value" data-field="pmiRequired">Calculating...</div>
                                </div>
                                <div class="form-group pmi-rate-override">
                                    <label>PMI Rate Override (Annual %)</label>
                                    <div class="input-wrapper percent-wrapper">
                                        <input type="number" name="pmiRateOverride" placeholder="Auto" step="0.01">
                                        <span class="percent">%</span>
                                    </div>
                                    <small class="helper-text">Leave blank for auto-calculation based on LTV/credit</small>
                                </div>
                                <div class="form-group pmi-rate hidden">
                                    <label>Estimated Monthly PMI</label>
                                    <div class="calculated-value" data-field="monthlyPMI">$0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Refinance Specific -->
                        <div class="form-section refinance-fields hidden">
                            <h3>Refinance Details</h3>
                            <div class="form-group">
                                <label>Current Loan Balance</label>
                                <div class="input-wrapper">
                                    <span class="currency">$</span>
                                    <input type="number" name="currentBalance" placeholder="250,000">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Current Interest Rate</label>
                                <div class="input-wrapper percent-wrapper">
                                    <input type="number" name="currentRate" placeholder="7.5" step="0.125">
                                    <span class="percent">%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Cash Out Amount</label>
                                <div class="input-wrapper">
                                    <span class="currency">$</span>
                                    <input type="number" name="cashOut" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Closing Costs Section -->
                        <div class="form-section closing-costs-section">
                            <div class="section-header">
                                <h3>Closing Costs & Fees</h3>
                                <button type="button" class="toggle-section-btn" data-target="closingCostsContent">
                                    <span class="toggle-icon">▼</span>
                                </button>
                            </div>

                            <div class="section-content closingCostsContent">
                                <div class="title-company-selector">
                                    <label>Load Saved Title Company Fees:</label>
                                    <select name="titleCompanySelect" class="title-company-dropdown">
                                        <option value="">-- Select Title Company --</option>
                                    </select>
                                </div>
                                <p class="section-note">All fees below are editable - adjust to match your actual loan estimate</p>

                                <h4 class="subsection-title">Lender Fees</h4>
                                <div class="closing-costs-grid">
                                    <div class="cost-item">
                                        <label>Origination Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="originationFee" value="1500">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Processing Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="processingFee" value="500">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Underwriting Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="underwritingFee" value="750">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Application Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="applicationFee" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Commitment Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="commitmentFee" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Rate Lock Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="rateLockFee" value="0">
                                        </div>
                                    </div>
                                </div>

                                <h4 class="subsection-title">Third Party Fees</h4>
                                <div class="closing-costs-grid">
                                    <div class="cost-item">
                                        <label>Appraisal Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="appraisalFee" value="550">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Credit Report</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="creditReport" value="75">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Flood Certification</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="floodCert" value="20">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Tax Service Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="taxServiceFee" value="85">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Survey</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="survey" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Pest Inspection</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="pestInspection" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Home Inspection</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="homeInspection" value="0">
                                        </div>
                                    </div>
                                </div>

                                <h4 class="subsection-title">Title & Government Fees</h4>
                                <div class="closing-costs-grid">
                                    <div class="cost-item">
                                        <label>Title Insurance (Lender's)</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="titleInsurance" value="900">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Title Insurance (Owner's)</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="ownersTitleInsurance" value="500">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Title Search/Exam</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="titleSearch" value="200">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Settlement/Closing Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="settlementFee" value="500">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Escrow/Title Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="escrowFees" value="350">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Recording Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="recordingFees" value="150">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Transfer Taxes</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="transferTaxes" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Attorney Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="attorneyFees" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Notary Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="notaryFees" value="50">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>Courier/Wire Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="courierFees" value="75">
                                        </div>
                                    </div>
                                </div>

                                <h4 class="subsection-title">Other Fees</h4>
                                <div class="closing-costs-grid">
                                    <div class="cost-item">
                                        <label>HOA Transfer Fee</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="hoaTransferFee" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item">
                                        <label>HOA Certification</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="hoaCertification" value="0">
                                        </div>
                                    </div>
                                    <div class="cost-item full-width">
                                        <label>Other/Miscellaneous Fees</label>
                                        <div class="input-wrapper">
                                            <span class="currency">$</span>
                                            <input type="number" name="otherFees" value="0">
                                        </div>
                                    </div>
                                </div>

                                <!-- Custom Fees Section -->
                                <div class="custom-fees-section">
                                    <h4 class="subsection-title">Custom Fees</h4>
                                    <div class="custom-fees-list">
                                        <!-- Custom fees will be added here dynamically -->
                                    </div>
                                    <button type="button" class="add-custom-fee-btn">
                                        <span>+</span> Add Custom Fee
                                    </button>
                                </div>

                            </div>
                        </div>

                        <!-- Prepaids Section -->
                        <div class="form-section prepaids-section">
                            <div class="section-header">
                                <h3>Prepaid Items & Escrow</h3>
                                <button type="button" class="toggle-section-btn" data-target="prepaidsContent">
                                    <span class="toggle-icon">▼</span>
                                </button>
                            </div>

                            <div class="section-content prepaidsContent">
                                <div class="form-group">
                                    <label>Property Taxes (Annual)</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="annualTaxes" value="3600">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Homeowners Insurance (Annual)</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="annualInsurance" value="1500">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>HOA Dues (Monthly)</label>
                                    <div class="input-wrapper">
                                        <span class="currency">$</span>
                                        <input type="number" name="monthlyHOA" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Months of Taxes to Prepay</label>
                                    <input type="number" name="taxMonths" value="3" min="0" max="12">
                                </div>
                                <div class="form-group">
                                    <label>Months of Insurance to Prepay</label>
                                    <input type="number" name="insuranceMonths" value="14" min="0" max="14">
                                </div>
                                <div class="form-group">
                                    <label>Days of Prepaid Interest</label>
                                    <input type="number" name="prepaidInterestDays" value="15" min="1" max="30">
                                </div>
                            </div>
                        </div>

                        <button type="button" class="calculate-btn">Calculate & Compare</button>
                    </form>

                    <!-- Results Section -->
                    <div class="results-section">
                        <h2>Loan Summary</h2>

                        <div class="results-grid">
                            <div class="result-card primary">
                                <h4>Monthly Payment</h4>
                                <div class="result-value" data-result="monthlyPayment">$0</div>
                                <small>Principal & Interest</small>
                            </div>
                            <div class="result-card">
                                <h4>Total Monthly (PITI + MI)</h4>
                                <div class="result-value" data-result="totalMonthly">$0</div>
                                <small>Including taxes, insurance & MI</small>
                            </div>
                            <div class="result-card">
                                <h4>Total Closing Costs</h4>
                                <div class="result-value" data-result="totalClosing">$0</div>
                            </div>
                            <div class="result-card">
                                <h4>Cash to Close</h4>
                                <div class="result-value" data-result="cashToClose">$0</div>
                                <small>Down payment + closing costs</small>
                            </div>
                            <div class="result-card">
                                <h4 class="tooltip-trigger">
                                    APR
                                    <span class="tooltip-icon" tabindex="0">?</span>
                                    <span class="tooltip-content">Annual Percentage Rate - The true yearly cost including interest and fees. Use this to compare loans from different lenders.</span>
                                </h4>
                                <div class="result-value" data-result="apr">0%</div>
                            </div>
                            <div class="result-card">
                                <h4>Total Interest (Life of Loan)</h4>
                                <div class="result-value" data-result="totalInterest">$0</div>
                            </div>
                        </div>

                        <!-- Borrower Split Section (shown when 2 borrowers) -->
                        <div class="borrower-split-section hidden">
                            <h3>Cost Split Between Borrowers</h3>
                            <div class="split-controls">
                                <label>Split Ratio:</label>
                                <div class="split-slider-container">
                                    <span class="borrower-label">Borrower 1</span>
                                    <input type="range" name="splitRatio" min="0" max="100" value="50" class="split-slider">
                                    <span class="borrower-label">Borrower 2</span>
                                </div>
                                <div class="split-display">
                                    <span data-split="borrower1Percent">50%</span> / <span data-split="borrower2Percent">50%</span>
                                </div>
                            </div>
                            <div class="split-results">
                                <div class="split-card">
                                    <h4>Borrower 1</h4>
                                    <div class="split-item">
                                        <span>Monthly Payment:</span>
                                        <strong data-split="borrower1Monthly">$0</strong>
                                    </div>
                                    <div class="split-item">
                                        <span>Cash to Close:</span>
                                        <strong data-split="borrower1CashToClose">$0</strong>
                                    </div>
                                </div>
                                <div class="split-card">
                                    <h4>Borrower 2</h4>
                                    <div class="split-item">
                                        <span>Monthly Payment:</span>
                                        <strong data-split="borrower2Monthly">$0</strong>
                                    </div>
                                    <div class="split-item">
                                        <span>Cash to Close:</span>
                                        <strong data-split="borrower2CashToClose">$0</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Fee Breakdown -->
                        <div class="fee-breakdown">
                            <h3>Fee Breakdown</h3>
                            <table class="fee-table">
                                <thead>
                                    <tr>
                                        <th>Fee Type</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="feeBreakdown">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                                <tfoot>
                                    <tr class="subtotal-row">
                                        <td>Subtotal (Before Credits)</td>
                                        <td data-result="feeSubtotal">$0</td>
                                    </tr>
                                    <tr class="credits-row">
                                        <td>Total Credits</td>
                                        <td data-result="totalCredits">-$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td><strong data-result="feeTotal">$0</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparison Summary (shown when multiple loans) -->
        <div class="comparison-summary hidden" id="comparisonSummary">
            <h2>Side-by-Side Comparison</h2>
            <div class="comparison-type-banner" id="comparisonTypeBanner">
                <svg class="banner-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span class="banner-text">Comparing different loan options for the <strong>same property</strong></span>
            </div>

            <!-- Comparison Charts -->
            <div class="charts-container">
                <div class="chart-wrapper">
                    <h3>Monthly Payment Comparison</h3>
                    <div class="chart-canvas-container">
                        <canvas id="monthlyPaymentChart" width="400" height="300"></canvas>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <h3>Cash to Close Comparison</h3>
                    <div class="chart-canvas-container">
                        <canvas id="cashToCloseChart" width="400" height="300"></canvas>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <h3>Total Cost Over Loan Life</h3>
                    <div class="chart-canvas-container">
                        <canvas id="totalCostChart" width="400" height="300"></canvas>
                    </div>
                </div>
                <div class="chart-wrapper full-width">
                    <h3>Monthly Payment Breakdown</h3>
                    <div class="chart-canvas-container">
                        <canvas id="paymentBreakdownChart" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>

            <!-- Time Period Selector & Net Cost Comparison -->
            <div class="time-comparison-section">
                <div class="time-period-selector">
                    <h3>Compare Over Time Period</h3>
                    <div class="time-options">
                        <button class="time-btn" data-months="0">None</button>
                        <button class="time-btn" data-months="12">1 Year</button>
                        <button class="time-btn" data-months="24">2 Years</button>
                        <button class="time-btn" data-months="36">3 Years</button>
                        <button class="time-btn active" data-months="60">5 Years</button>
                        <button class="time-btn" data-months="84">7 Years</button>
                        <button class="time-btn" data-months="120">10 Years</button>
                        <button class="time-btn" data-months="180">15 Years</button>
                        <button class="time-btn" data-months="360">30 Years</button>
                        <div class="custom-time-input">
                            <input type="number" id="customMonths" placeholder="Custom" min="1" max="360">
                            <span>months</span>
                        </div>
                    </div>
                </div>

                <div class="net-cost-comparison" id="netCostComparison">
                    <h3>Net Cost Difference <span class="time-label">(over 5 years)</span></h3>
                    <div class="net-cost-grid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="comparison-table-wrapper">
                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <!-- Dynamic columns added by JS -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="recommendation" id="recommendation">
                <!-- Recommendation populated by JS -->
            </div>

            <!-- Generate Document Button -->
            <div class="document-actions">
                <button type="button" class="generate-doc-btn" id="generateDocBtn">
                    <svg class="doc-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    Generate Comparison Document for Borrower
                </button>
                <button type="button" class="print-btn" id="printBtn">
                    <svg class="doc-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                    Print Comparison
                </button>
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div class="modal-overlay hidden" id="documentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Loan Comparison Document</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="document-options">
                    <div class="form-group">
                        <label>Borrower Name(s)</label>
                        <input type="text" id="borrowerName" placeholder="Enter borrower name(s)">
                    </div>
                    <div class="form-group">
                        <label>Property Address</label>
                        <input type="text" id="propertyAddress" placeholder="Enter property address">
                    </div>
                    <div class="form-group">
                        <label>Loan Officer Name</label>
                        <input type="text" id="loanOfficerName" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="companyName" placeholder="Your company">
                    </div>
                    <div class="form-group">
                        <label>Contact Information</label>
                        <input type="text" id="contactInfo" placeholder="Phone/Email">
                    </div>
                    <div class="form-group">
                        <label>Additional Notes</label>
                        <textarea id="additionalNotes" rows="3" placeholder="Any additional notes for the borrower..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Report Options</label>
                        <div class="branding-toggle" style="margin-top: 8px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="showTimePeriodToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-text">Show time period comparison on report</span>
                        </div>
                        <small class="helper-text" style="margin-top: 8px; display: block;">When enabled, includes the selected time period (months/years) cost analysis in the borrower report</small>
                    </div>

                    <div class="email-section">
                        <h4>Send via Email</h4>
                        <div class="email-inputs">
                            <div class="form-group">
                                <label>Recipient Email</label>
                                <input type="email" id="recipientEmail" placeholder="borrower@email.com">
                            </div>
                            <div class="form-group">
                                <label>Email Subject</label>
                                <input type="text" id="emailSubject" placeholder="Your Loan Comparison Summary">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="document-preview" id="documentPreview">
                    <!-- Document preview generated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="copyDocBtn">Copy to Clipboard</button>
                <button class="btn-secondary" id="emailDocBtn">Send via Email</button>
                <button class="btn-primary" id="downloadDocBtn">Download as HTML</button>
                <button class="btn-primary" id="printDocBtn">Print Document</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner large"></div>
            <p id="loadingText">Loading...</p>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="shortcuts-overlay" id="shortcutsOverlay"></div>
    <div class="shortcuts-modal" id="shortcutsModal">
        <h3>Keyboard Shortcuts</h3>
        <ul class="shortcut-list">
            <li><span>Calculate loans</span> <kbd>Ctrl + Enter</kbd></li>
            <li><span>Add new loan</span> <kbd>Ctrl + N</kbd></li>
            <li><span>Save scenario</span> <kbd>Ctrl + S</kbd></li>
            <li><span>Open settings</span> <kbd>Ctrl + ,</kbd></li>
            <li><span>Generate document</span> <kbd>Ctrl + P</kbd></li>
            <li><span>Show shortcuts</span> <kbd>?</kbd></li>
            <li><span>Close modal</span> <kbd>Esc</kbd></li>
        </ul>
        <button class="btn-secondary" onclick="KeyboardShortcuts.hideHelp()" style="margin-top: 15px; width: 100%;">Close</button>
    </div>

    <!-- AI Mortgage Assistant Chatbot -->
    <div class="chat-widget" id="chatWidget">
        <div class="chat-toggle" id="chatToggle">
            <div class="chat-toggle-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                </svg>
            </div>
            <div class="chat-toggle-pulse"></div>
            <span class="chat-toggle-label">Ask AI</span>
        </div>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 1 4 4v2a4 4 0 0 1-8 0V6a4 4 0 0 1 4-4z"/>
                            <path d="M16 14H8a4 4 0 0 0-4 4v2h16v-2a4 4 0 0 0-4-4z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="chat-title">Mortgage Assistant</div>
                        <div class="chat-status">
                            <span class="status-dot"></span>
                            Online
                        </div>
                    </div>
                </div>
                <button class="chat-close" id="chatClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot">
                    <div class="message-avatar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 1 4 4v2a4 4 0 0 1-8 0V6a4 4 0 0 1 4-4z"/>
                            <path d="M16 14H8a4 4 0 0 0-4 4v2h16v-2a4 4 0 0 0-4-4z"/>
                        </svg>
                    </div>
                    <div class="message-content">
                        <p>Hi! I'm your mortgage assistant. I can help you understand:</p>
                        <ul>
                            <li>Loan types (FHA, VA, Conventional, etc.)</li>
                            <li>Down payment requirements</li>
                            <li>Credit score guidelines</li>
                            <li>DTI ratios and affordability</li>
                            <li>Closing costs and fees</li>
                        </ul>
                        <p>What would you like to know?</p>
                    </div>
                </div>
            </div>
            <div class="chat-quick-questions" id="chatQuickQuestions">
                <button class="quick-question" data-question="What credit score do I need for a mortgage?">Credit requirements</button>
                <button class="quick-question" data-question="What is PMI and how can I avoid it?">About PMI</button>
                <button class="quick-question" data-question="What's the difference between FHA and Conventional loans?">FHA vs Conventional</button>
                <button class="quick-question" data-question="How much down payment do I need?">Down payment</button>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Type your mortgage question..." autocomplete="off">
                <button class="chat-send" id="chatSend">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="script.js"></script>
    <script src="tools.js"></script>
</body>
</html>
